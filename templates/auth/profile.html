{% extends 'base.html' %}

{% block title %}{% if user.nickname %}{{ user.nickname }}{% else %}{{ user.email }}{% endif %}{% endblock %}


{% block content %}
<div class="w-full md:w-3/4 xl:w-1/2 mx-auto shadow-md shadow-gray-400 p-6 mt-5">
    <div class="flex flex-col md:flex-row items-center md:gap-4">
        <label class="basis-1/5 shrink-0 text-right font-bold">이메일</label>
        <input value="{{ user.email }}" disabled />
    </div>
    <div class="text-right mb-4">
        {% if user.email_verified %}
        <p class="text-sm text-green-700 font-bold"><i class="fa-solid fa-circle-check"></i> email_verified</p>
        {% else %}
        <button class="email-verify-btn mx-auto bg-gray-200 rounded px-3 py-1 font-bold text-sm mt-1">이메일 인증하기</button>
        {% endif %}
    </div>
    <form method="post">
        {% csrf_token %}
        <div class="flex flex-col md:flex-row items-center md:gap-4">
            <label for="{{ form.nickname.id_for_label }}" class="basis-1/5 shrink-0 text-right font-bold">{{ form.nickname.label }}</label>
            <div class="grow">{{ form.nickname }}</div>
            <div class="">
                <button class="font-bold text-sm px-3 py-1 rounded bg-gray-200">저장</button>
            </div>
        </div>
    </form>
</div>

<script>
    (() => {
        const email_verify_btn = document.querySelector('.email-verify-btn');
        if (email_verify_btn) {
            email_verify_btn.addEventListener('click', (e) => {
                const btn = e.target;
                btn.innerText = '이메일 발송중..';
                btn.setAttribute('disabled', '')
                btn.style.backgroundColor = "Orange"
                btn.style.color = "white";
                fetch("{% url 'users:send-verification' %}")
                    .then((response) => {
                        btn.style.backgroundColor = "MediumSeaGreen";
                        btn.style.color = "white";
                        btn.innerText = "이메일 발송 완료";
                    })
                    .catch((error) => {
                        console.log(error);
                        btn.innerText = "에러발생";
                        btn.style.backgroundColor = "red";
                        btn.style.color = "white";
                    });
            });
        }
    })();
</script>
{% endblock %}